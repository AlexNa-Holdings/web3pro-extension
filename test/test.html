<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MetaMask Test Page</title>
</head>
<body>
  <h1>MetaMask Test Operations</h1>

  <!-- Connect Button -->
  <button id="connectButton">Connect to MetaMask</button>

  <!-- Display Ethereum Address -->
  <p id="address">Address: Not connected</p>

  <!-- Display Network -->
  <p id="network">Network: Not connected</p>

  <!-- Add Network Button -->
  <button id="addNetworkButton">Add Custom Network</button>

  <!-- Add Token Button -->
  <button id="addTokenButton">Add Custom Token</button>

  <script>
    // Check if MetaMask is installed
    if (typeof window.ethereum !== 'undefined') {
      console.log('MetaMask is installed!');
      
      // Listen for account changes
      window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length > 0) {
          addressDisplay.innerText = `Address: ${accounts[0]}`;
        } else {
          addressDisplay.innerText = 'Address: Not connected';
        }
      });

      // Listen for network changes
      window.ethereum.on('chainChanged', (chainId) => {
        getNetwork();
      });
    } else {
      alert('MetaMask is not installed. Please install it to use this page.');
    }

    const connectButton = document.getElementById('connectButton');
    const addressDisplay = document.getElementById('address');
    const networkDisplay = document.getElementById('network');
    const addNetworkButton = document.getElementById('addNetworkButton');
    const addTokenButton = document.getElementById('addTokenButton');

    // Connect to MetaMask
    connectButton.addEventListener('click', async () => {
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const account = accounts[0];
        addressDisplay.innerText = `Address: ${account}`;
        getNetwork();
      } catch (error) {
        console.error('User denied account access', error);
      }
    });

    // Get current network
    async function getNetwork() {
      try {
        const chainId = await window.ethereum.request({ method: 'eth_chainId' });
        let networkName;
        switch(chainId) {
          case '0x1':
            networkName = 'Ethereum Mainnet';
            break;
          case '0x3':
            networkName = 'Ropsten Testnet';
            break;
          case '0x4':
            networkName = 'Rinkeby Testnet';
            break;
          case '0x5':
            networkName = 'Goerli Testnet';
            break;
          case '0x2a':
            networkName = 'Kovan Testnet';
            break;
          default:
            networkName = `Unknown Network (Chain ID: ${chainId})`;
        }
        networkDisplay.innerText = `Network: ${networkName}`;
      } catch (error) {
        console.error('Failed to get network', error);
      }
    }

    // Add a custom network
    addNetworkButton.addEventListener('click', async () => {
      try {
        await window.ethereum.request({
          method: 'wallet_addEthereumChain',
          params: [{
            chainId: '0x89', // Chain ID in hex, for example, 137 (Polygon Mainnet) is 0x89
            chainName: 'Polygon Mainnet',
            nativeCurrency: {
              name: 'MATIC',
              symbol: 'MATIC',
              decimals: 18
            },
            rpcUrls: ['https://rpc-mainnet.maticvigil.com/'],
            blockExplorerUrls: ['https://polygonscan.com/']
          }]
        });
        console.log('Network added');
      } catch (error) {
        console.error('Failed to add network', error);
      }
    });

    // Add a custom token
    addTokenButton.addEventListener('click', async () => {
      try {
        const wasAdded = await window.ethereum.request({
          method: 'wallet_watchAsset',
          params: {
            type: 'ERC20',
            options: {
              address: '0xTOKEN_ADDRESS_HERE', // Replace with the token contract address
              symbol: 'TOKEN', // Token symbol, e.g., 'DAI'
              decimals: 18, // Token decimals
              image: 'https://example.com/token-image.png', // URL of token image
            },
          },
        });

        if (wasAdded) {
          console.log('Token added');
        } else {
          console.log('Token not added');
        }
      } catch (error) {
        console.error('Failed to add token', error);
      }
    });
  </script>
</body>
</html>
